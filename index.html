<!DOCTYPE html>
<html>
<head>
    <title>Data Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        button {
            background-color: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #005a87;
        }
        .last-update {
            text-align: center;
            color: #666;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📊 Live Data Dashboard</h1>
        
        <div class="controls">
            <button onclick="loadData()">🔄 Refresh Data</button>
            <div class="last-update" id="lastUpdate">Last update: Never</div>
        </div>

        <div class="chart-container">
            <canvas id="mainChart"></canvas>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <p>This dashboard automatically updates when new data is uploaded from the C# application.</p>
        </div>
    </div>

    <script>
        let currentChart = null;

        async function loadData() {
            try {
                // Show loading state
                document.querySelector('button').textContent = '⏳ Loading...';
                document.querySelector('button').disabled = true;

                // Replace with YOUR actual GitHub username and repository name
                const username = 'YOUR_GITHUB_USERNAME';
                const repo = 'YOUR_REPO_NAME';
                
                // Load data from GitHub - this is where your C# program uploads the data
                const dataUrl = `https://raw.githubusercontent.com/${username}/${repo}/main/data.json`;
                console.log('Loading data from:', dataUrl);
                
                const response = await fetch(dataUrl);
                
                if (!response.ok) {
                    throw new Error(`Failed to load data: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Data loaded successfully:', data.length, 'records');
                
                createChart(data);
                updateLastUpdateTime();
                
            } catch (error) {
                console.error('Error loading data:', error);
                alert('Error loading data: ' + error.message + '\n\nMake sure:\n1. Your GitHub username and repo name are correct\n2. The data.json file exists in your repository\n3. You have published the repository to GitHub Pages');
            } finally {
                // Reset button state
                document.querySelector('button').textContent = '🔄 Refresh Data';
                document.querySelector('button').disabled = false;
            }
        }

        function createChart(data) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            // Destroy previous chart if it exists
            if (currentChart) {
                currentChart.destroy();
            }

            // Process data for Chart.js
            const labels = data.map(d => new Date(d.timestamp).toLocaleString());
            const values = data.map(d => d.value);

            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sensor Data',
                        data: values,
                        borderColor: '#007cba',
                        backgroundColor: 'rgba(0, 124, 186, 0.1)',
                        borderWidth: 2,
                        tension: 0.1,
                        fill: true,
                        pointBackgroundColor: '#007cba',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Time'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Value'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            beginAtZero: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'nearest'
                    }
                }
            });
        }

        function updateLastUpdateTime() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                `Last update: ${now.toLocaleString()}`;
        }

        // Auto-refresh every 2 minutes
        setInterval(loadData, 120000);

        // Load data when page first opens
        window.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard loaded - waiting for data...');
            loadData();
        });
    </script>
</body>
</html>